<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTTPS 握个手 | JSen的前端日志</title>
    <meta name="description" content="欢迎访问我的前端日志">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/icon.jpeg">
    
    <link rel="preload" href="/assets/css/0.styles.a0074007.css" as="style"><link rel="preload" href="/assets/js/app.5ee48ca4.js" as="script"><link rel="preload" href="/assets/js/2.9bf8985c.js" as="script"><link rel="preload" href="/assets/js/8.53608965.js" as="script"><link rel="prefetch" href="/assets/js/10.789a365b.js"><link rel="prefetch" href="/assets/js/11.59507d2a.js"><link rel="prefetch" href="/assets/js/12.f6c2b69a.js"><link rel="prefetch" href="/assets/js/13.93e4a112.js"><link rel="prefetch" href="/assets/js/14.7e1df415.js"><link rel="prefetch" href="/assets/js/15.eeb76e2a.js"><link rel="prefetch" href="/assets/js/16.078fbec8.js"><link rel="prefetch" href="/assets/js/17.bf06c628.js"><link rel="prefetch" href="/assets/js/18.34ddcd6a.js"><link rel="prefetch" href="/assets/js/3.e5cb48b9.js"><link rel="prefetch" href="/assets/js/4.63cde35e.js"><link rel="prefetch" href="/assets/js/5.52e88bc0.js"><link rel="prefetch" href="/assets/js/6.e51c9011.js"><link rel="prefetch" href="/assets/js/7.e53a2638.js"><link rel="prefetch" href="/assets/js/9.ed1725d1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a0074007.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">JSen的前端日志</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  博客
</a></div> <a href="https://github.com/chenxiaosen/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  博客
</a></div> <a href="https://github.com/chenxiaosen/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/Promise 快速使用.html" class="sidebar-link">Promise 快速使用</a></li><li><a href="/blog/ES5的继承.html" class="sidebar-link">ES5 的继承</a></li><li><a href="/blog/手写系列.html" class="sidebar-link">手写系列</a></li><li><a href="/blog/尾递归优化.html" class="sidebar-link">尾递归优化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/React Hooks 使用和总结.html" class="sidebar-link">React Hooks 使用和总结</a></li><li><a href="/blog/React性能优化之使用 ImmutableJS 不可变数据.html" class="sidebar-link">React性能优化之使用 ImmutableJS 不可变数据</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>HTTP</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/HTTP协议.html" class="sidebar-link">HTTP 协议</a></li><li><a href="/blog/HTTP缓存.html" class="sidebar-link">HTTP 浏览器缓存机制</a></li><li><a href="/blog/HTTPS握个手.html" class="active sidebar-link">HTTPS 握个手</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/HTTPS握个手.html#对称加密" class="sidebar-link">对称加密</a></li><li class="sidebar-sub-header"><a href="/blog/HTTPS握个手.html#非对称加密" class="sidebar-link">非对称加密</a></li><li class="sidebar-sub-header"><a href="/blog/HTTPS握个手.html#http-s-https" class="sidebar-link">HTTP + S ==&gt; HTTPS</a></li><li class="sidebar-sub-header"><a href="/blog/HTTPS握个手.html#ssl-tls-协议握手过程" class="sidebar-link">SSL/TLS 协议握手过程</a></li><li class="sidebar-sub-header"><a href="/blog/HTTPS握个手.html#参考文章" class="sidebar-link">参考文章</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>编程基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/函数式编程.html" class="sidebar-link">函数式编程</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="https-握个手"><a href="#https-握个手" class="header-anchor">#</a> HTTPS 握个手</h1> <p>在开始 HTTPS 之前，我们先来了解下 <strong>对称加密</strong> 和 <strong>非对称加密</strong> <a name="y45qf"></a></p> <h2 id="对称加密"><a href="#对称加密" class="header-anchor">#</a> 对称加密</h2> <p>对称加密不难理解，就是加密和解密使用相同的密钥，比如文本 <code>&quot;a&quot;</code> 使用 <code>&quot;123&quot;</code> 加密后的密文，用 <code>&quot;123&quot;</code> 作为密钥可以解密出文本 <code>&quot;a&quot;</code>，常见的对称加密有 <strong>AES、DES、3DES</strong>。
<a name="QwPaZ"></a></p> <h2 id="非对称加密"><a href="#非对称加密" class="header-anchor">#</a> 非对称加密</h2> <p>非对称加密，顾名思义就是加密的密钥和解密的用的不一样。我们先来看看知乎的这篇高分回答<a href="https://www2.zhihu.com/question/33645891/answer/57512229" target="_blank" rel="noopener noreferrer">如何用通俗易懂的话来解释非对称加密?<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>首先，每个用户都有两把钥匙，一把公钥一把私钥。公钥是对外发布的，所有人都看的到所有人的公钥，私钥是自己保存，每个人都只知道自己的私钥而不知道别人的。</strong><br>**</p> <blockquote><p><strong>用该用户的公钥加密后只能该用户的私钥才能解密。这种情况下，公钥是用来加密信息的，确保只有特定的人（用谁的公钥就是谁）才能解密该信息。</strong>
下面我拿A银行和小明来举例子吧。假设这2者之间是用不对称的加密算法来保证信息传输的安全性（不被第三人知道信息的含义及篡改信息）。大致流程如下：首先小明发了一条信息给A银行“我要存500元”。这条信息小明会根据A银行的对外发布的公钥把这条信息加密了，加密之后，变成“XXXXXXX”发给A银行。中间被第三者截获，由于没有A银行的私钥无法解密，不能知道信息的含义，也无法按正确的方式篡改。所以拿这条加密信息是没办法的。最后被A银行接受，A银行用自己的私钥去解密这条信息，解密成功，读取内容，执行操作。然后得知消息是小明发来的，便去拿小明的公钥，把“操作成功（或失败）”这条信息用小明的公钥加密，发给小明。同理最后小明用自己的私钥解开，得知知乎发来的信息内容。其他人截获因为没有小明的私钥所以也没有用。</p></blockquote> <blockquote><p><strong>还有第二种情况，公钥是用来解密信息的，确保让别人知道这条信息是真的由我发布的，是完整正确的。接收者由此可知这条信息确实来自于拥有私钥的某人，这被称作数字签名，公钥的形式就是数字证书。</strong>
怎么理解呢？继续拿小明和银行A举例子。银行A发布了一个银行客户端的补丁供所有用户更新，那为了确保人家下载的是正确完整的客户端，银行A会为这个程序打上一个数字签名（就是用银行A的私钥对这个程序加密然后发布），你需要在你的电脑里装上银行A的数字证书（就是银行对外发布的公钥），然后下载好这个程序，数字证书会去解密这个程序的数字签名，解密成功，补丁得以使用。同时你能知道这个补丁确实是来自这个银行A，是由他发布的，而不是其他人发布的。</p></blockquote> <p><br>常用的非对称加密有 <strong>RSA</strong>。<br></p> <p><a name="Nf1ci"></a></p> <h2 id="http-s-https"><a href="#http-s-https" class="header-anchor">#</a> HTTP + S ==&gt; HTTPS</h2> <p>我们先来看看 HTTP 和 HTTPS 的对比。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/780243/1587270619982-183655ca-a7f3-477b-ad69-af19c326f697.png#align=left&amp;display=inline&amp;height=301&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=602&amp;originWidth=1488&amp;size=200271&amp;status=done&amp;style=none&amp;width=744" alt="image.png"><br></p> <blockquote><p>HTTPS凭什么就能做到机密性、完整性这些安全特性呢?
秘密就在于HTTPS名字里的“S”，它把 HTTP 下层的传输协议由 TCP/IP 换成了 SSL/TLS，由“HTTP over TCP/IP”变成了“HTTP over SSL/TLS”，让HTTP运行在了安全的 SSL/TLS 协议上，收发报文不再使用Socket API，而是调用专门的安全接口</p></blockquote> <p>所以 HTTPS 安全的核心就是 SSL/TLS 协议，SSL/TLS 协议的握手就是建立连接和交换参数，交换客户端与服务器之间的信息从而生成会话秘钥(主秘钥)，用来加密之后的消息。<br>可以这么理解，<strong>握手过程的信息用到了非对称加密</strong>，<strong>而建立连接之后的信息通信，是对称加密</strong>。
<a name="4jSwE"></a></p> <h2 id="ssl-tls-协议握手过程"><a href="#ssl-tls-协议握手过程" class="header-anchor">#</a> SSL/TLS 协议握手过程</h2> <p><br>TLS中有两种主要的握手类型：一种基于<a href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)" target="_blank" rel="noopener noreferrer">RSA<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，一种基于<a href="https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange" target="_blank" rel="noopener noreferrer">Diffie-Hellman<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。 这两种握手类型的主要区别在于主秘钥交换和认证上。<br></p> <table><thead><tr><th style="text-align:left;"></th> <th style="text-align:left;">秘钥交换</th> <th style="text-align:left;">身份验证</th></tr></thead> <tbody><tr><td style="text-align:left;">RSA握手</td> <td style="text-align:left;">RSA</td> <td style="text-align:left;">RSA</td></tr> <tr><td style="text-align:left;">DH握手</td> <td style="text-align:left;">DH</td> <td style="text-align:left;">RSA/DSA</td></tr></tbody></table> <p><a name="b9705157"></a></p> <h3 id="rsa握手"><a href="#rsa握手" class="header-anchor">#</a> RSA握手</h3> <p>基于 RSA 的 TLS 握手整个流程如下如所示<br><img src="https://cdn.nlark.com/yuque/0/2020/png/780243/1587280076265-c66f4ca7-ecec-442c-a505-587cd48ed79e.png#align=left&amp;display=inline&amp;height=627&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1254&amp;originWidth=1374&amp;size=240459&amp;status=done&amp;style=none&amp;width=687" alt="image.png"></p> <ol><li><strong>客户端向服务器发送Client Hello</strong>,告诉服务器，我支持的协议版本，加密套件等信息。</li> <li>服务器收到响应，选择双方都支持的协议，套件，<strong>向客户端发送Server Hello</strong>。同时服务器也将自己的<strong>证书</strong>发送到客户端(Certificate)。</li> <li>客户端自己生产预主密钥，通过<strong>公钥加密预主秘钥</strong>，将加密后的预主秘钥发送给服务器 (Client Exchange)。</li> <li>服务器<strong>用自己的私钥解密加密的预主密钥</strong>。</li></ol> <p><br>之后，客户端与服务器用相同的算法根据客户端随机数，服务器随机数，预主秘钥生产主密钥，之后的通信将都用主密钥加密解密。<br> <br>握手过程需要注意以下三点</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>（<span class="token number">1</span>）生成对话密钥一共需要三个随机数，用以生成主密钥。
（<span class="token number">2</span>）握手之后的对话使用<span class="token string">&quot;对话密钥&quot;</span>加密（对称加密），服务器的公钥和私钥只用于加密和解密<span class="token string">&quot;对话密钥&quot;</span>（非对称加密），无其他作用。
（<span class="token number">3</span>）服务器公钥放在服务器的数字证书之中。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><a name="0d925359"></a></p> <h3 id="dh握手"><a href="#dh握手" class="header-anchor">#</a> DH握手</h3> <p><br>TLS握手采用DH算法的流程图<br><img src="https://cdn.nlark.com/yuque/0/2020/png/780243/1587280881760-cb021b12-6845-41c5-82c1-7066255a4a7d.png#align=left&amp;display=inline&amp;height=693&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1386&amp;originWidth=1613&amp;size=461743&amp;status=done&amp;style=none&amp;width=806.5" alt="image.png"></p> <ol><li>客户端<strong>向服务器发送 Client Hello</strong>, 告诉服务器，我支持的协议版本，加密套件等信息。<br></li> <li>a. 服务端收到响应，选择双方都支持的协议，套件，向客户端发送 Server Hello。同时服务器也将自己的<strong>证书发送到客户端</strong>(Certificate)。<br>b. 服务器利用私钥将客户端随机数，服务器随机数，服务器 DH 参数签名，生成<strong>服务器签名</strong>。<br></li> <li>服务端向客户端<strong>发送服务器 DH 参数以及服务器签名(Server Key Exchange)</strong>。<br></li> <li>客户端向服务端<strong>发送客户端 DH 参数(Client Key Exchange)</strong>。</li></ol> <p><br>之后，客户端利用公钥验证服务器签名，客户端与服务器各自利用服务端DH参数、客户端DH参数生成预主密钥，再通过预主密钥、客户端随机数、服务端随机数生成主密钥(会话密钥)。最后握手完成，所有的消息都通过主密钥加密。<br></p> <p><a name="xCeY1"></a></p> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p>RSA 握手和 DH 握手的主要差别，在于 <strong>RSA 是通过公钥加密的预主密钥发送给服务端</strong>，而 DH 握手前两步的验证身份和 RSA 握手一致，在交换密钥时是<strong>通过各自发送 DH 参数完成密钥交换</strong>。之后算出共同的会话主密钥，用于会话加密。目前的 SSL/TLS 协议 主流是基于 RSA 握手。</p> <p><a name="5Lvux"></a></p> <h2 id="参考文章"><a href="#参考文章" class="header-anchor">#</a> 参考文章</h2> <p><a href="https://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html" target="_blank" rel="noopener noreferrer">图解SSL/TLS协议<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <br><a href="https://quguang.wang/post/geektime-http-protocol/" target="_blank" rel="noopener noreferrer">《透视HTTP协议》-https<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <br><a href="https://razeencheng.com/post/ssl-handshake-detail" target="_blank" rel="noopener noreferrer">HTTPS篇之SSL握手过程详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/HTTP缓存.html" class="prev">
        HTTP 浏览器缓存机制
      </a></span> <span class="next"><a href="/blog/函数式编程.html">
        函数式编程
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5ee48ca4.js" defer></script><script src="/assets/js/2.9bf8985c.js" defer></script><script src="/assets/js/8.53608965.js" defer></script>
  </body>
</html>
